<% unless @latitude %>
  <script>
    getGeoLocation();
  </script>
<% end %>

<div class="page-header">
  <div class="container">
      <h1><%= @beach.name %> <small><a href="<%= @response['url'] %>" target="_blank"><img src="<%= @response['rating_img_url'] %>"></a> <%= @response['review_count'] %> reviews</small></h1>
  </div>
</div>

<div class="container">

  <div class="row">
    <img src="<%= @beach.main_image %>">
    <div class="col-sm-4 col-md-4 col-md-offset-1 well pull-right">
      <address>
        <%= @response['location']['address'][0] %><br>
          <% if @response['location']['cross_streets'] %>
            Cross streets: <%= @response['location']['cross_streets'] %><br>
          <% end %>
        <%= @response['location']['city'] %>, <%= @response['location']['state_code'] %> <%= @response['location']['postal_code'] %><br>
        <a href="<%= @directions %>">Directions</a>
      </address>

      <% unless @results['route'].empty? %>
        <p>
          <strong>Distance:</strong> <%= @results['route']['distance'] %> miles<br>
          <strong>Regular Travel Time:</strong> 
          <%= @results['route']['time']/60 %> minutes<br>
          <strong>Current Travel time:</strong> 
          <%= @results['route']['realTime']/60 %> minutes
        </p>
      <% end %>
      <p><a href="<%= photos_link(@beach.name, @response['location']['city']) %>">See photos on Flickr</a></p>
    </div>

    <div class="col-md-7 pull-left">
      <% @response['reviews'].each do |review| %>
        <p><img src="<%= review['rating_image_url']%>"> <%= Time.at(review['time_created']).to_date %><br>
          <%= review['excerpt'] %> <a href="<%= @response['url'] %>#hrid:<%= review['id']%>" target="_blank">Read more</a><br>
        </p>
      <% end %>
      <p class="pull-right"><a href="http://www.yelp.com"><img src="/assets/reviewsFromYelpWHT.gif"></a></p>
    
    </div>
  </div>

<% cache(@response['id'], :expires_in => 5.minutes) do %>
  <% @weather = weather(@response['location']['postal_code']) %>
  <div class="row">
    <h2>Weather Information</h2>
    <div class="col-md-6">

      <div class="row">
        <div class="col-md-2 pull-left">
          <p class="current_temp"><img src="<%= @weather['current_observation']['icon_url'] %>">
          </p>
        </div>
        <div class="col-md-10 pull-right">
          <p><span class="current_temp"><%= @weather['current_observation']['temperature_string'] %></span><br>
            <%= @weather['current_observation']['weather'] %>
          </p>
        </div>
      </div>
      <p><strong><%= @weather['forecast']['txt_forecast']['forecastday'][0]['title'] %>:</strong> <%= @weather['forecast']['txt_forecast']['forecastday'][0]['fcttext'] %></p>
      <p><strong><%= @weather['forecast']['txt_forecast']['forecastday'][1]['title'] %>:</strong> <%= @weather['forecast']['txt_forecast']['forecastday'][1]['fcttext'] %></p>

      <p>
        <a href="<%= @weather['current_observation']['forecast_url'] %>" target="_blank">Full Forecast</a>
      </p>
    </div>
    
    <div class="col-md-6 table-responsive">
      <table class="table table-condensed">
        <thead>
          <tr>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Feels like:</td>
            <td><%= @weather['current_observation']['feelslike_string'] %></td>
          <tr>
            <td>Humidity:</td>
            <td><%= @weather['current_observation']['relative_humidity'] %></td>
          </tr>
          <tr>
            <td>Wind:</td>
            <td><%= @weather['current_observation']['wind_string'] %></td>
          </tr>
          <tr>
            <td>UV Index:</td>
            <td><%= @weather['current_observation']['UV'] %> out of 16</td>
          </tr>
          <tr>
            <td>Sunset:</td>
            <td><%= @weather['sun_phase']['sunset']['hour'] %>:<%= @weather['sun_phase']['sunset']['minute'] %></td>
          </tr>
        </tbody>
      </table>
      <p>
        <strong>Observed location:</strong> <%= @weather['current_observation']['observation_location']['city'] %><br>
        <em><%= @weather['current_observation']['observation_time'] %></em>
      </p>
    </div>

  </div>
  <% end %>
</div>